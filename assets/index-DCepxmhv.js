(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();const B=.9,ue={0:[[[.1,.1],[.1,.9]],[[.1,.9],[.7,.9]],[[.7,.9],[.7,.1]],[[.7,.1],[.1,.1]]],1:[[[.4,.1],[.4,.9]]],2:[[[.1,.9],[.7,.9]],[[.7,.9],[.7,.5]],[[.7,.5],[.1,.5]],[[.1,.5],[.1,.1]],[[.1,.1],[.7,.1]]],3:[[[.1,.9],[.7,.9]],[[.7,.9],[.7,.1]],[[.1,.1],[.7,.1]],[[.1,.5],[.7,.5]]],4:[[[.1,.9],[.1,.5]],[[.1,.5],[.7,.5]],[[.7,.9],[.7,.1]]],5:[[[.7,.9],[.1,.9]],[[.1,.9],[.1,.5]],[[.1,.5],[.7,.5]],[[.7,.5],[.7,.1]],[[.1,.1],[.7,.1]]],6:[[[.7,.9],[.1,.9]],[[.1,.9],[.1,.1]],[[.1,.1],[.7,.1]],[[.7,.1],[.7,.5]],[[.1,.5],[.7,.5]]],7:[[[.1,.9],[.7,.9]],[[.7,.9],[.7,.1]]],8:[[[.1,.1],[.1,.9]],[[.7,.1],[.7,.9]],[[.1,.1],[.7,.1]],[[.1,.5],[.7,.5]],[[.1,.9],[.7,.9]]],9:[[[.1,.9],[.7,.9]],[[.1,.5],[.7,.5]],[[.7,.9],[.7,.1]],[[.1,.9],[.1,.5]]],".":[[[.3,.1],[.5,.1]]],"-":[[[.1,.5],[.7,.5]]]},K=String.raw`M73 P0 R19
M73 Q0 S21
M201 X10000 Y10000 Z400 E5000 ; sets maximum accelerations, mm/sec^2
M203 X350 Y350 Z12 E100 ; sets maximum feedrates, mm / sec
M204 P7000 R2500 T7000 ; sets acceleration (P, T) and retract acceleration (R), mm/sec^2
M205 X10.00 Y10.00 Z2.00 E10.00 ; sets the jerk limits, mm/sec
M205 S0 T0 ; sets the minimum extruding and travel feed rate, mm/sec

M486 S0
M486 AShape-Box
M486 S-1

;TYPE:Custom
M17 ; enable steppers
M862.1 P0.4 A0 F1 ; nozzle check
M862.3 P "COREONE" ; printer model check
M862.5 P2 ; g-code level check
M862.6 P"Input shaper" ; FW feature check
M115 U6.3.4+10511

M555 X112.5 Y93.5 W32 H29

G90 ; use absolute coordinates
M83 ; extruder relative mode

M140 S[bed_temperature] ; set bed temp

M109 R170 ; wait for temp

M84 E ; turn off E motor

G28 ; home all without mesh bed level

M141 S20 ; set nominal chamber temp

M106 S70
G0 Z40 F10000
M104 T0 S170
M190 R[bed_temperature] ; wait for bed temp
M107

G29 G ; absorb heat

M109 R170 ; wait for MBL temp

M302 S155 ; lower cold extrusion limit to 155C

G1 E-2 F2400 ; retraction

M84 E ; turn off E motor

G29 P9 X208 Y-2.5 W32 H4

;
; MBL
;
M84 E ; turn off E motor
G29 P1 ; invalidate mbl & probe print area
G29 P1 X150 Y0 W100 H20 C ; probe near purge place
G29 P3.2 ; interpolate mbl probes
G29 P3.13 ; extrapolate mbl outside probe area
G29 A ; activate mbl

; prepare for purge
M104 S[hotend_temperature]
G0 X249 Y-2.5 Z15 F4800 ; move away and ready for the purge
M109 S[hotend_temperature]

G92 E0
M569 S0 E ; set spreadcycle mode for extruder

M591 S0 ; disable stuck detection

;
; Extrude purge line
;
G92 E0 ; reset extruder position
G1 E2 F2400 ; deretraction after the initial one
G0 E5 X235 Z0.2 F500 ; purge
G0 X225 E4 F500 ; purge
G0 X215 E4 F650 ; purge
G0 X205 E4 F800 ; purge
G0 X202 Z0.05 F8000 ; wipe, move close to the bed
M73 P1 R19
G0 X199 Z0.2 F8000 ; wipe, move quickly away from the bed

M591 R ; restore stuck detection

G92 E0
M221 S100 ; set flow to 100%
G21 ; set units to millimeters
G90 ; use absolute coordinates
M83 ; use relative distances for extrusion
M572 S0.036 ; Filament gcode

M142 S36 ; set heatbreak target temp
M107`,ee=String.raw`M107
;TYPE:Custom
; Filament-specific end gcode
G1 Z26 F720 ; Move print head up
M104 S0 ; turn off temperature
M140 S0 ; turn off heatbed
M141 S0 ; disable chamber control
M107 ; turn off fan
G1 X242 Y211 F10200 ; park
G4 ; wait
M572 S0 ; reset PA
M84 X Y E ; disable motors
; max_layer_z = 25
M73 P100 R0
M73 Q100 S0`;function j(t,e,r){if(t<=1)return[e];const n=(r-e)/(t-1),o=[];for(let s=0;s<t;s++)o.push(e+s*n);return o}function Ee(t){const e=t/2;return Math.PI*e*e}function ce(t,e,r){return t*e*.9/r}function pe(t,e,r,n){if(t!=null&&(t<0||t>r))throw new Error(`G-code X move ${t.toFixed(3)} is outside bed [0, ${r}]`);if(e!=null&&(e<0||e>n))throw new Error(`G-code Y move ${e.toFixed(3)} is outside bed [0, ${n}]`)}function T({x:t=null,y:e=null,z:r=null,e:n=null,f:o=null,bedX:s,bedY:i}){pe(t,e,s,i);const l=["G1"];return t!=null&&l.push(`X${t.toFixed(3)}`),e!=null&&l.push(`Y${e.toFixed(3)}`),r!=null&&l.push(`Z${r.toFixed(3)}`),n!=null&&l.push(`E${n.toFixed(5)}`),o!=null&&l.push(`F${o.toFixed(0)}`),l.join(" ")}function J(t,e,r){return t.replace(/\[bed_temperature\]/g,String(e)).replace(/\[hotend_temperature\]/g,String(r))}function _e(t,e){const r=e*60;return{retract:`G1 E${(-t).toFixed(5)} F${r.toFixed(0)}`,deretract:`G1 E${t.toFixed(5)} F${r.toFixed(0)}`}}function g(t,e){const r=e*60,n=t;return{retract:`G1 E${(-n).toFixed(5)} F${r.toFixed(0)}`,deretract:`G1 E${n.toFixed(5)} F${r.toFixed(0)}`}}function me(){const t=new Date,e=n=>n.toString().padStart(2,"0");return`retraction_doe_test_${`${t.getFullYear()}${e(t.getMonth()+1)}${e(t.getDate())}_${e(t.getHours())}${e(t.getMinutes())}`}.gcode`}function Se(t){const e={BED_SIZE_X:t.bedX,BED_SIZE_Y:t.bedY,MIN_RETRACT_DIST:t.minDist,MAX_RETRACT_DIST:t.maxDist,MIN_RETRACT_SPEED:t.minSpeed,MAX_RETRACT_SPEED:t.maxSpeed,ROWS:t.rows,COLS:t.cols,LINES_PER_PARAM:t.linesPerParam,NUM_DOE_LAYERS:t.numLayers,SEGMENT_LENGTH:t.segLen,TRAVEL_LENGTH:t.travelLen,FLOW_FACTOR:t.flowFactor,BED_TEMP:t.bedTemp,HOTEND_TEMP:t.hotendTemp,FIRST_LAYER_SPEED:t.firstLayerSpeed,PRINT_SPEED:t.printSpeed,TRAVEL_SPEED:t.travelSpeed,PRINT_ACCEL:t.printAccel,RETRACT_ACCEL:t.retractAccel,TRAVEL_ACCEL:t.travelAccel,FIRST_LAYER_PRINT_ACCEL:t.firstLayerPrintAccel,LAYER_HEIGHT:t.layerHeight,FIRST_LAYER_Z:t.firstLayerZ,TEXT_PRINT_SPEED:t.textSpeed,ROW_FONT_SIZE:t.rowFontSize,SPEED_FONT_SIZE:t.speedFontSize,EXTRUSION_WIDTH:t.extrusionWidth,FILAMENT_DIAMETER:1.75,ROW_GAP:t.rowGap,MARGIN:t.margin,DIST_LABEL_PAD:t.distLabelPad,PRESSURE_ADVANCE:t.pressureAdvance};e.FILAMENT_AREA=Ee(e.FILAMENT_DIAMETER);const r=ce(e.EXTRUSION_WIDTH,e.LAYER_HEIGHT,e.FILAMENT_AREA);e.E_PER_MM=r*e.FLOW_FACTOR,e.AVG_RETRACT_DIST=.5*(e.MIN_RETRACT_DIST+e.MAX_RETRACT_DIST),e.AVG_RETRACT_SPEED=.5*(e.MIN_RETRACT_SPEED+e.MAX_RETRACT_SPEED);const n=[];n.push("; Retraction DOE Test"),n.push("; Generated by retraction_doe_generator (Vite + modular)"),n.push(`; Retraction distance: ${e.MIN_RETRACT_DIST}..${e.MAX_RETRACT_DIST} mm`),n.push(`; Retraction speed:    ${e.MIN_RETRACT_SPEED}..${e.MAX_RETRACT_SPEED} mm/s`),n.push(`; Row repetitions (parallel lines per parameter): ${e.LINES_PER_PARAM}`),n.push(`; Flow factor: ${e.FLOW_FACTOR.toFixed(3)}`),n.push("; Always prints: grid frame + L-shaped label base + labels."),n.push("");const o=t.startGcode||K,s=t.endGcode||ee,i=J(o,e.BED_TEMP,e.HOTEND_TEMP).trim(),l=J(s,e.BED_TEMP,e.HOTEND_TEMP).trim();if(i){if(n.push(i),n.push(""),Number.isFinite(e.PRESSURE_ADVANCE)){const G=e.PRESSURE_ADVANCE;n.push(`pressure_advance = ${G}`),n.push(`M572 S${G}`),n.push("")}let I=e.FIRST_LAYER_PRINT_ACCEL!==null&&e.FIRST_LAYER_PRINT_ACCEL!==void 0?e.FIRST_LAYER_PRINT_ACCEL:e.PRINT_ACCEL;const P=Number.isFinite(e.RETRACT_ACCEL)?e.RETRACT_ACCEL:"",y=Number.isFinite(e.TRAVEL_ACCEL)?e.TRAVEL_ACCEL:"";(Number.isFinite(I)||P!==""||y!=="")&&(n.push(`M204 P${I} R${P} T${y}`),n.push(""))}const _=j(e.ROWS,e.MIN_RETRACT_DIST,e.MAX_RETRACT_DIST),u=j(e.COLS,e.MIN_RETRACT_SPEED,e.MAX_RETRACT_SPEED),p=e.COLS*(e.SEGMENT_LENGTH+e.TRAVEL_LENGTH)+e.SEGMENT_LENGTH,a=e.LINES_PER_PARAM*e.EXTRUSION_WIDTH+e.ROW_GAP,c=e.ROWS*a-e.ROW_GAP+e.EXTRUSION_WIDTH,L=1,M=1;let f=0;_.forEach(I=>{const P=(I.toFixed(2)+"mm").length*B*e.ROW_FONT_SIZE;P>f&&(f=P)});const D=f+L+e.DIST_LABEL_PAD,h=Math.max(e.MARGIN,e.SPEED_FONT_SIZE+M),A=D+p+e.MARGIN,b=h+c;if(A>e.BED_SIZE_X+1e-6||b>e.BED_SIZE_Y+1e-6)throw new Error(`Pattern+labels too big for bed: needs ${A.toFixed(2)} x ${b.toFixed(2)} mm, bed is ${e.BED_SIZE_X.toFixed(2)} x ${e.BED_SIZE_Y.toFixed(2)} mm`);const d=(e.BED_SIZE_X-A)/2,E=(e.BED_SIZE_Y-b)/2,m=d+D,R=E+h;n.push(`; Centered on bed ${e.BED_SIZE_X}x${e.BED_SIZE_Y} mm`),n.push(`; Base bbox origin: X${d.toFixed(2)} Y${E.toFixed(2)}`),n.push(`; Pattern origin:   X${m.toFixed(2)} Y${R.toFixed(2)}`),n.push(`; Left label area:  ${D.toFixed(2)} mm, Bottom label margin: ${h.toFixed(2)} mm`),n.push("");const S=e.FIRST_LAYER_Z,F=S+e.LAYER_HEIGHT;if(n.push(T({z:S,f:e.TRAVEL_SPEED*60,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),fe(n,e,{baseX0:d,baseY0:E,originX:m,originY:R,leftLabelArea:D,bottomLabelMargin:h,patternWidth:p,patternHeight:c,z:S}),he(n,e,{z:S,originX:m,originY:R,rows:e.ROWS,cols:e.COLS,rowBlockHeight:a,patternWidth:p}),n.push(""),n.push(`; === DOE Layer 1/${e.NUM_DOE_LAYERS} at Z=${S.toFixed(3)}, speed=${e.FIRST_LAYER_SPEED}mm/s ===`),W(n,e,{z:S,originX:m,originY:R,rows:e.ROWS,cols:e.COLS,distances:_,speeds:u,rowBlockHeight:a,patternWidth:p,printSpeed:e.FIRST_LAYER_SPEED}),e.NUM_DOE_LAYERS>=2){const I=Number.isFinite(e.PRINT_ACCEL)?e.PRINT_ACCEL:"",P=Number.isFinite(e.RETRACT_ACCEL)?e.RETRACT_ACCEL:"",y=Number.isFinite(e.TRAVEL_ACCEL)?e.TRAVEL_ACCEL:"";(I!==""||P!==""||y!=="")&&(n.push(""),n.push(`M204 P${I} R${P} T${y}`),n.push(""))}e.NUM_DOE_LAYERS>=2&&(n.push(""),n.push("; --- Printing labels for distances and speeds on second layer ---"),Te(n,e,{originX:m,originY:R,baseX0:d,baseY0:E,rowBlockHeight:a,distLevels:_,speedLevels:u,rowFontSize:e.ROW_FONT_SIZE,speedFontSize:e.SPEED_FONT_SIZE,labelGapX:L,bottomLabelMargin:h,zLabel:F}),n.push(""),n.push(`; === DOE Layer 2/${e.NUM_DOE_LAYERS} at Z=${F.toFixed(3)}, speed=${e.PRINT_SPEED}mm/s ===`),W(n,e,{z:F,originX:m,originY:R,rows:e.ROWS,cols:e.COLS,distances:_,speeds:u,rowBlockHeight:a,patternWidth:p,printSpeed:e.PRINT_SPEED}));for(let I=2;I<e.NUM_DOE_LAYERS;I++){const P=S+I*e.LAYER_HEIGHT;n.push(""),n.push(`; === DOE Layer ${I+1}/${e.NUM_DOE_LAYERS} at Z=${P.toFixed(3)}, speed=${e.PRINT_SPEED}mm/s ===`),W(n,e,{z:P,originX:m,originY:R,rows:e.ROWS,cols:e.COLS,distances:_,speeds:u,rowBlockHeight:a,patternWidth:p,printSpeed:e.PRINT_SPEED})}const C=g(e.AVG_RETRACT_DIST,e.AVG_RETRACT_SPEED);return n.push(""),n.push("; Final retraction"),n.push(C.retract),l&&(n.push(""),n.push(l)),n.join(`
`)+`
`}function q(t,e,r,n,o,s,i,l){const _=i.TEXT_PRINT_SPEED*60,u=i.TRAVEL_SPEED*60,p=i.E_PER_MM;let a=r;for(const c of e){if(c===" "){a+=B*o;continue}const L=ue[c];if(!L){a+=B*o;continue}for(const M of L){const[[f,D],[h,A]]=M,b=a+f*o,d=n+D*o,E=a+h*o,m=n+A*o;t.push("; Label retract before travel"),t.push(l.retract),t.push(T({x:b,y:d,z:s,f:u,bedX:i.BED_SIZE_X,bedY:i.BED_SIZE_Y})),t.push("; Label deretract before stroke"),t.push(l.deretract);const S=Math.hypot(E-b,m-d)*p;t.push(T({x:E,y:m,e:S,f:_,bedX:i.BED_SIZE_X,bedY:i.BED_SIZE_Y}))}a+=B*o}}function fe(t,e,r){const{baseX0:n,baseY0:o,originX:s,originY:i,leftLabelArea:l,bottomLabelMargin:_,patternWidth:u,patternHeight:p,z:a}=r;t.push(`; --- L-shaped label base at Z=${a.toFixed(3)} ---`);const c=e.FIRST_LAYER_SPEED*60,L=e.TRAVEL_SPEED*60,M=e.EXTRUSION_WIDTH,f=e.E_PER_MM,D=l,h=n,A=u,b=s,d=o,E=l,m=n,R=o,S=e.EXTRUSION_WIDTH,F=n,C=o,I=s+u,P=i+p,y=s-S,G=i-S;t.push(`; L-shape perimeter for adhesion (offset by ${S.toFixed(3)}mm from grid)`),t.push(T({x:F,y:C,z:a,f:L,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}));let x,N;x=I-F,N=x*f,t.push(T({x:I,y:C,e:N,f:c,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),x=G-C,N=x*f,t.push(T({x:I,y:G,e:N,f:c,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),x=I-y,N=x*f,t.push(T({x:y,y:G,e:N,f:c,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),x=P-G,N=x*f,t.push(T({x:y,y:P,e:N,f:c,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),x=y-F,N=x*f,t.push(T({x:F,y:P,e:N,f:c,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),x=P-C,N=x*f,t.push(T({x:F,y:C,e:N,f:c,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}));function v(Y,O,w,H,le){if(w<=0||H<=0)return;t.push(`; ${le}: X${Y.toFixed(3)} Y${O.toFixed(3)} W${w.toFixed(3)} H${H.toFixed(3)}`),t.push(T({x:Y,y:O,z:a,f:L,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}));const de=Math.round(H/M);for(let $=0;$<de;$++){const U=O+$*M,z=$%2===0?Y:Y+w,k=$%2===0?Y+w:Y;t.push(T({x:z,y:U,f:L,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}));const ae=Math.abs(k-z)*f;t.push(T({x:k,y:U,e:ae,f:c,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}))}}const X=Math.floor((_-2*S)/M)*M,oe=X,V=R+S+X,se=i+p-V,ie=Math.ceil(se/M)*M;v(m+S,R+S,E-2*S,X,"L-corner fill"),v(h+S,V,D-2*S,ie,"L-left fill"),v(b,d+S,A-S,oe,"L-bottom fill")}function he(t,e,r){const{z:n,originX:o,originY:s,rows:i,cols:l,rowBlockHeight:_,patternWidth:u}=r;t.push(`; --- Grid frame layer at Z=${n.toFixed(3)} ---`);const p=e.FIRST_LAYER_SPEED*60,a=e.TRAVEL_SPEED*60,c=e.E_PER_MM,L=i*_-e.ROW_GAP+e.EXTRUSION_WIDTH,M=e.SEGMENT_LENGTH+e.TRAVEL_LENGTH,f=o,D=o+u,h=s,A=s+L,b=g(e.AVG_RETRACT_DIST,e.AVG_RETRACT_SPEED);t.push("; Grid frame: outer rectangle"),t.push("; Grid retract before travel to outer start"),t.push(b.retract),t.push(T({x:f,y:h,z:n,f:a,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),t.push("; Grid deretract before outer rectangle"),t.push(b.deretract);let d,E;d=D-f,E=d*c,t.push(T({x:D,y:h,e:E,f:p,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),d=A-h,E=d*c,t.push(T({x:D,y:A,e:E,f:p,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),d=D-f,E=d*c,t.push(T({x:f,y:A,e:E,f:p,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),d=A-h,E=d*c,t.push(T({x:f,y:h,e:E,f:p,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),t.push("; Grid frame: vertical lines between columns");for(let m=1;m<l;m++){const R=o+m*M;t.push("; Grid retract before vertical travel"),t.push(b.retract),t.push(T({x:R,y:h,z:n,f:a,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),t.push("; Grid deretract before vertical line"),t.push(b.deretract),d=A-h,E=d*c,t.push(T({x:R,y:A,e:E,f:p,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}))}t.push("; Grid frame: horizontal lines between rows");for(let m=1;m<i;m++){const R=s+m*_;t.push("; Grid retract before horizontal travel"),t.push(b.retract),t.push(T({x:f,y:R,z:n,f:a,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),t.push("; Grid deretract before horizontal line"),t.push(b.deretract),d=D-f,E=d*c,t.push(T({x:D,y:R,e:E,f:p,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}))}}function W(t,e,r){const{z:n,originX:o,originY:s,rows:i,cols:l,distances:_,speeds:u,rowBlockHeight:p,patternWidth:a,printSpeed:c}=r;t.push(`; --- DOE layer at Z=${n.toFixed(3)} ---`);const L=c*60,M=e.TRAVEL_SPEED*60,f=e.E_PER_MM,D=e.EXTRUSION_WIDTH;for(let h=0;h<i;h++){const A=_[h],b=s+h*p+D;t.push(`; ===== Distance row ${h+1}/${i}, dist=${A.toFixed(3)}mm =====`);let d=o;for(let E=0;E<e.LINES_PER_PARAM;E++){const m=E%2===0?1:-1,R=b+E*e.EXTRUSION_WIDTH;E===0&&(d=o),t.push(T({x:d,y:R,z:n,f:M,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),t.push(`; Row ${h+1}/${i}, repetition ${E+1}/${e.LINES_PER_PARAM}, dist=${A.toFixed(3)}mm, dir=${m>0?"L->R":"R->L"}`);const S=m>0?[...Array(l).keys()]:[...Array(l).keys()].reverse();for(const P of S){const y=u[P],G=_e(A,y);t.push(`;   Col ${P+1}/${l}, speed=${y.toFixed(1)}mm/s`);let x=d+m*e.SEGMENT_LENGTH,v=Math.abs(x-d)*f;t.push(T({x,y:R,e:v,f:L,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),d=x,t.push(G.retract);let X=d+m*e.TRAVEL_LENGTH;t.push(T({x:X,y:R,f:M,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),d=X,t.push(G.deretract)}t.push(";   Final normal print section at end of repetition line");const F=d+m*e.SEGMENT_LENGTH,I=Math.abs(F-d)*f;t.push(T({x:F,y:R,e:I,f:L,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),d=F}}}function Te(t,e,r){const{originX:n,originY:o,baseX0:s,baseY0:i,rowBlockHeight:l,distLevels:_,speedLevels:u,rowFontSize:p,speedFontSize:a,labelGapX:c,bottomLabelMargin:L,zLabel:M}=r,f=g(e.AVG_RETRACT_DIST,e.AVG_RETRACT_SPEED);_.forEach((A,b)=>{const d=A.toFixed(2)+"mm",E=d.length*B*p,R=o+b*l+l/2-p/2,S=n-c-E,F=s+e.DIST_LABEL_PAD,C=Math.max(S,F);t.push(`; Text label for distance row ${b+1}: ${d}`),q(t,d,C,R,p,M,e,f)});const D=e.SEGMENT_LENGTH+e.TRAVEL_LENGTH,h=i+(L-a)/2;u.forEach((A,b)=>{const d=A.toFixed(0)+"mm/s",E=d.length*B*a,S=n+b*D+e.SEGMENT_LENGTH+e.TRAVEL_LENGTH/2-E/2;t.push(`; Text label for speed col ${b+1}: ${d}`),q(t,d,S,h,a,M,e,f)})}const Re="modulepreload",be=function(t){return"/retraction-optimizer/"+t},Q={},Le=function(e,r,n){let o=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.allSettled(r.map(_=>{if(_=be(_),_ in Q)return;Q[_]=!0;const u=_.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${_}"]${p}`))return;const a=document.createElement("link");if(a.rel=u?"stylesheet":Re,u||(a.as="script"),a.crossOrigin="",a.href=_,l&&a.setAttribute("nonce",l),document.head.appendChild(a),u)return new Promise((c,L)=>{a.addEventListener("load",c),a.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${_}`)))})}))}function s(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return o.then(i=>{for(const l of i||[])l.status==="rejected"&&s(l.reason);return e().catch(s)})},Ae=[{id:"default",name:"Default",file:"default.json"},{id:"prusa-mk3s",name:"Prusa MK3S+",file:"prusa-mk3s.json"},{id:"bambu-x1c",name:"Bambu Lab X1C",file:"bambu-x1c.json"},{id:"prusa-coreone",name:"Prusa Core One",file:"prusa-coreone.json"}],Z={},te={};async function De(){for(const t of Ae)try{const e=await Le(()=>import(`../presets/${t.file}`),[]);Z[t.id]=e.default,te[t.id]=t}catch(e){console.error(`Failed to load preset ${t.id}:`,e)}}async function Ie(){Object.keys(Z).length===0&&await De()}function Pe(t){return Z[t]||null}function Me(){return Object.keys(Z)}function xe(t){var e;return((e=te[t])==null?void 0:e.name)||t}function ne(){const t=u=>document.getElementById(u),e=(u,p,a)=>{const c=t(u)||p&&t(p);if(!c)return a;const L=c.value;return L===""||L===void 0?a:Number(L)},r=(u,p,a)=>{const c=e(u,p,a);return Number.isNaN(c)?a:Math.trunc(c)},n=e("retractDist",null,null),o=e("minDist",null,n),s=e("maxDist",null,n),i=e("retractSpeed",null,null),l=e("minSpeed",null,i),_=e("maxSpeed",null,i);return{bedX:e("bedX",null,220),bedY:e("bedY",null,220),bedTemp:e("bedTemp",null,60),minDist:o,maxDist:s,hotendTemp:e("hotendTemp",null,210),minSpeed:l,maxSpeed:_,flowFactor:e("flowFactor",null,1),firstLayerSpeed:e("firstLayerSpeed",null,30),printSpeed:e("printSpeed",null,50),travelSpeed:e("travelSpeed",null,150),printAccel:e("printAccel",null,1500),retractAccel:e("retractAccel",null,2500),travelAccel:e("travelAccel",null,5e3),layerHeight:e("layerHeight",null,.2),pressureAdvance:function(){const u=t("pressureAdvance");return u?u.value===""?null:Number(u.value):null}(),firstLayerZ:e("firstLayerZ",null,.2),textSpeed:e("textSpeed",null,20),rowFontSize:e("rowFontSize",null,3),speedFontSize:e("speedFontSize",null,3),extrusionWidth:e("extrusionWidth",null,.44),rowGap:e("rowGap",null,1),margin:e("margin",null,5),distLabelPad:e("distLabelPad",null,1),linesPerParam:r("linesPerParam","doeLines",12),rows:r("rows","doeRows",5),cols:r("cols","doeColumns",5),segLen:e("segLen","doeSegments",15),travelLen:e("travelLen",null,15),numLayers:r("numLayers",null,5),firstLayerPrintAccel:function(){const u=e("firstLayerPrintAccel",null,null);return u===null?null:u}(),startGcode:(document.getElementById("startGcode")||{value:""}).value,endGcode:(document.getElementById("endGcode")||{value:""}).value,presetName:(t("presetName")||{value:""}).value,presetDescription:(t("presetDescription")||{value:""}).value}}function re(t){const e=(r,n,o)=>{const s=document.getElementById(r)||n&&document.getElementById(n);s&&(s.value=o==null?"":String(o))};t.bedX!==void 0&&e("bedX",null,t.bedX),t.bedY!==void 0&&e("bedY",null,t.bedY),t.bedTemp!==void 0&&e("bedTemp",null,t.bedTemp),t.minDist!==void 0&&e("minDist","retractDist",t.minDist),t.maxDist!==void 0&&e("maxDist",null,t.maxDist),t.hotendTemp!==void 0&&e("hotendTemp",null,t.hotendTemp),t.minSpeed!==void 0&&e("minSpeed","retractSpeed",t.minSpeed),t.maxSpeed!==void 0&&e("maxSpeed",null,t.maxSpeed),t.flowFactor!==void 0&&e("flowFactor",null,t.flowFactor),t.firstLayerSpeed!==void 0&&e("firstLayerSpeed",null,t.firstLayerSpeed),t.printSpeed!==void 0&&e("printSpeed",null,t.printSpeed),t.travelSpeed!==void 0&&e("travelSpeed",null,t.travelSpeed),t.printAccel!==void 0&&e("printAccel",null,t.printAccel),t.retractAccel!==void 0&&e("retractAccel",null,t.retractAccel),t.travelAccel!==void 0&&e("travelAccel",null,t.travelAccel),t.layerHeight!==void 0&&e("layerHeight",null,t.layerHeight),t.pressureAdvance!==void 0&&e("pressureAdvance",null,t.pressureAdvance),t.firstLayerZ!==void 0&&e("firstLayerZ",null,t.firstLayerZ),t.textSpeed!==void 0&&e("textSpeed",null,t.textSpeed),t.rowFontSize!==void 0&&e("rowFontSize",null,t.rowFontSize),t.speedFontSize!==void 0&&e("speedFontSize",null,t.speedFontSize),t.extrusionWidth!==void 0&&e("extrusionWidth",null,t.extrusionWidth),t.rowGap!==void 0&&e("rowGap",null,t.rowGap),t.margin!==void 0&&e("margin",null,t.margin),t.distLabelPad!==void 0&&e("distLabelPad",null,t.distLabelPad),t.linesPerParam!==void 0&&e("linesPerParam","doeLines",t.linesPerParam),t.rows!==void 0&&e("rows","doeRows",t.rows),t.cols!==void 0&&e("cols","doeColumns",t.cols),t.segLen!==void 0&&e("segLen","doeSegments",t.segLen),t.travelLen!==void 0&&e("travelLen",null,t.travelLen),t.numLayers!==void 0&&e("numLayers",null,t.numLayers),t.firstLayerPrintAccel!==void 0&&e("firstLayerPrintAccel",null,t.firstLayerPrintAccel),t.startGcode!==void 0&&e("startGcode",null,t.startGcode),t.endGcode!==void 0&&e("endGcode",null,t.endGcode),t.presetName!==void 0&&e("presetName",null,t.presetName),t.presetDescription!==void 0&&e("presetDescription",null,t.presetDescription)}function Fe(){const t=document.getElementById("preset-select");t.innerHTML='<option value="">-- Select a printer --</option>',Me().forEach(e=>{const r=xe(e),n=document.createElement("option");n.value=e,n.textContent=r,t.appendChild(n)})}function ye(){const t=document.getElementById("preset-select"),e=document.getElementById("preset-status"),r=t.value;if(!r){e.textContent="";return}const n=Pe(r);if(!n){e.textContent="Preset not found",e.style.color="#ef4444";return}re(n);const o=n.name||n.presetName,s=n.description||n.presetDescription;o&&(document.getElementById("presetName").value=o),s&&(document.getElementById("presetDescription").value=s),e.textContent=`Loaded: ${o||"Preset"}`,e.style.color="#059669"}function Ne(t){const e=document.getElementById("preset-status"),r=t.target.files[0];if(!r)return;const n=new FileReader;n.onload=function(o){try{const s=JSON.parse(o.target.result);re(s);const i=s.name||s.presetName,l=s.description||s.presetDescription;i&&(document.getElementById("presetName").value=i),l&&(document.getElementById("presetDescription").value=l),e.textContent=`Loaded: ${i||"Custom settings"}`,e.style.color="#059669"}catch(s){e.textContent="Error parsing JSON: "+s.message,e.style.color="#ef4444",console.error(s)}},n.onerror=function(){e.textContent="Error reading file",e.style.color="#ef4444"},n.readAsText(r),t.target.value=""}function Ce(){const t=document.getElementById("status"),e=document.getElementById("output");try{t.textContent="Generatingâ€¦",t.classList.remove("error");const r=ne(),n=Se(r);e.value=n,t.textContent="G-code generated. You can download it now.",document.getElementById("download-btn").disabled=!1}catch(r){t.textContent="Error: "+r.message,t.classList.add("error"),document.getElementById("download-btn").disabled=!0,console.error(r)}}function Ge(){const t=document.getElementById("output").value;if(!t.trim())return;const e=new Blob([t],{type:"text/plain"}),r=URL.createObjectURL(e),n=document.createElement("a");n.href=r,n.download=me(),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}function Xe(){const t=ne(),e=t.presetName||"untitled",r=new Date,n=`${r.getFullYear()}${String(r.getMonth()+1).padStart(2,"0")}${String(r.getDate()).padStart(2,"0")}-${String(r.getHours()).padStart(2,"0")}${String(r.getMinutes()).padStart(2,"0")}`,o=JSON.stringify(t,null,2),s=new Blob([o],{type:"application/json"}),i=URL.createObjectURL(s),l=document.createElement("a");l.href=i;const _=e.replace(/\s+/g,"_").toLowerCase();l.download=`${_}_${n}.json`,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i)}async function Ye(){await Ie();const t=document.getElementById("startGcode"),e=document.getElementById("endGcode");t&&!t.value&&(t.value=K),e&&!e.value&&(e.value=ee),Fe(),document.getElementById("load-preset-btn").addEventListener("click",ye),document.getElementById("generate-btn").addEventListener("click",Ce),document.getElementById("download-btn").addEventListener("click",Ge),document.getElementById("download-json-btn").addEventListener("click",Xe),document.getElementById("upload-json-input").addEventListener("change",Ne)}window.addEventListener("DOMContentLoaded",Ye);
