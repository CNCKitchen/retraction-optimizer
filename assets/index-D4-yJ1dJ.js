(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();const Y=.9,pe={0:[[[.1,.1],[.1,.9]],[[.1,.9],[.7,.9]],[[.7,.9],[.7,.1]],[[.7,.1],[.1,.1]]],1:[[[.4,.1],[.4,.9]]],2:[[[.1,.9],[.7,.9]],[[.7,.9],[.7,.5]],[[.7,.5],[.1,.5]],[[.1,.5],[.1,.1]],[[.1,.1],[.7,.1]]],3:[[[.1,.9],[.7,.9]],[[.7,.9],[.7,.1]],[[.1,.1],[.7,.1]],[[.1,.5],[.7,.5]]],4:[[[.1,.9],[.1,.5]],[[.1,.5],[.7,.5]],[[.7,.9],[.7,.1]]],5:[[[.7,.9],[.1,.9]],[[.1,.9],[.1,.5]],[[.1,.5],[.7,.5]],[[.7,.5],[.7,.1]],[[.1,.1],[.7,.1]]],6:[[[.7,.9],[.1,.9]],[[.1,.9],[.1,.1]],[[.1,.1],[.7,.1]],[[.7,.1],[.7,.5]],[[.1,.5],[.7,.5]]],7:[[[.1,.9],[.7,.9]],[[.7,.9],[.7,.1]]],8:[[[.1,.1],[.1,.9]],[[.7,.1],[.7,.9]],[[.1,.1],[.7,.1]],[[.1,.5],[.7,.5]],[[.1,.9],[.7,.9]]],9:[[[.1,.9],[.7,.9]],[[.1,.5],[.7,.5]],[[.7,.9],[.7,.1]],[[.1,.9],[.1,.5]]],".":[[[.3,.1],[.5,.1]]],"-":[[[.1,.5],[.7,.5]]]},te=String.raw`M73 P0 R19
M73 Q0 S21
M201 X10000 Y10000 Z400 E5000 ; sets maximum accelerations, mm/sec^2
M203 X350 Y350 Z12 E100 ; sets maximum feedrates, mm / sec
M204 P7000 R2500 T7000 ; sets acceleration (P, T) and retract acceleration (R), mm/sec^2
M205 X10.00 Y10.00 Z2.00 E10.00 ; sets the jerk limits, mm/sec
M205 S0 T0 ; sets the minimum extruding and travel feed rate, mm/sec

M486 S0
M486 AShape-Box
M486 S-1

;TYPE:Custom
M17 ; enable steppers
M862.1 P0.4 A0 F1 ; nozzle check
M862.3 P "COREONE" ; printer model check
M862.5 P2 ; g-code level check
M862.6 P"Input shaper" ; FW feature check
M115 U6.3.4+10511

M555 X112.5 Y93.5 W32 H29

G90 ; use absolute coordinates
M83 ; extruder relative mode

M140 S[bed_temperature] ; set bed temp

M109 R170 ; wait for temp

M84 E ; turn off E motor

G28 ; home all without mesh bed level

M141 S20 ; set nominal chamber temp

M106 S70
G0 Z40 F10000
M104 T0 S170
M190 R[bed_temperature] ; wait for bed temp
M107

G29 G ; absorb heat

M109 R170 ; wait for MBL temp

M302 S155 ; lower cold extrusion limit to 155C

G1 E-2 F2400 ; retraction

M84 E ; turn off E motor

G29 P9 X208 Y-2.5 W32 H4

;
; MBL
;
M84 E ; turn off E motor
G29 P1 ; invalidate mbl & probe print area
G29 P1 X150 Y0 W100 H20 C ; probe near purge place
G29 P3.2 ; interpolate mbl probes
G29 P3.13 ; extrapolate mbl outside probe area
G29 A ; activate mbl

; prepare for purge
M104 S[hotend_temperature]
G0 X249 Y-2.5 Z15 F4800 ; move away and ready for the purge
M109 S[hotend_temperature]

G92 E0
M569 S0 E ; set spreadcycle mode for extruder

M591 S0 ; disable stuck detection

;
; Extrude purge line
;
G92 E0 ; reset extruder position
G1 E2 F2400 ; deretraction after the initial one
G0 E5 X235 Z0.2 F500 ; purge
G0 X225 E4 F500 ; purge
G0 X215 E4 F650 ; purge
G0 X205 E4 F800 ; purge
G0 X202 Z0.05 F8000 ; wipe, move close to the bed
M73 P1 R19
G0 X199 Z0.2 F8000 ; wipe, move quickly away from the bed

M591 R ; restore stuck detection

G92 E0
M221 S100 ; set flow to 100%
G21 ; set units to millimeters
G90 ; use absolute coordinates
M83 ; use relative distances for extrusion
M572 S0.036 ; Filament gcode

M142 S36 ; set heatbreak target temp
M107`,ne=String.raw`M107
;TYPE:Custom
; Filament-specific end gcode
G1 Z26 F720 ; Move print head up
M104 S0 ; turn off temperature
M140 S0 ; turn off heatbed
M141 S0 ; disable chamber control
M107 ; turn off fan
G1 X242 Y211 F10200 ; park
G4 ; wait
M572 S0 ; reset PA
M84 X Y E ; disable motors
; max_layer_z = 25
M73 P100 R0
M73 Q100 S0`;function Q(t,e,r){if(t<=1)return[e];const n=(r-e)/(t-1),o=[];for(let s=0;s<t;s++)o.push(e+s*n);return o}function _e(t){const e=t/2;return Math.PI*e*e}function me(t,e,r){return t*e*.95/r}function Se(t,e,r,n){if(t!=null&&(t<0||t>r))throw new Error(`G-code X move ${t.toFixed(3)} is outside bed [0, ${r}]`);if(e!=null&&(e<0||e>n))throw new Error(`G-code Y move ${e.toFixed(3)} is outside bed [0, ${n}]`)}function T({x:t=null,y:e=null,z:r=null,e:n=null,f:o=null,bedX:s,bedY:i}){Se(t,e,s,i);const d=["G1"];return t!=null&&d.push(`X${t.toFixed(3)}`),e!=null&&d.push(`Y${e.toFixed(3)}`),r!=null&&d.push(`Z${r.toFixed(3)}`),n!=null&&d.push(`E${n.toFixed(5)}`),o!=null&&d.push(`F${o.toFixed(0)}`),d.join(" ")}function K(t,e,r){return t.replace(/\[bed_temperature\]/g,String(e)).replace(/\[hotend_temperature\]/g,String(r))}function fe(t,e){const r=e*60;return{retract:`G1 E${(-t).toFixed(5)} F${r.toFixed(0)}`,deretract:`G1 E${t.toFixed(5)} F${r.toFixed(0)}`}}function V(t,e){const r=e*60,n=t;return{retract:`G1 E${(-n).toFixed(5)} F${r.toFixed(0)}`,deretract:`G1 E${n.toFixed(5)} F${r.toFixed(0)}`}}function Te(){const t=new Date,e=n=>n.toString().padStart(2,"0");return`retraction_doe_test_${`${t.getFullYear()}${e(t.getMonth()+1)}${e(t.getDate())}_${e(t.getHours())}${e(t.getMinutes())}`}.gcode`}function he(t){const e={BED_SIZE_X:t.bedX,BED_SIZE_Y:t.bedY,MIN_RETRACT_DIST:t.minDist,MAX_RETRACT_DIST:t.maxDist,MIN_RETRACT_SPEED:t.minSpeed,MAX_RETRACT_SPEED:t.maxSpeed,ROWS:t.rows,COLS:t.cols,LINES_PER_PARAM:t.linesPerParam,NUM_DOE_LAYERS:t.numLayers,SEGMENT_LENGTH:t.segLen,TRAVEL_LENGTH:t.travelLen,FLOW_FACTOR:t.flowFactor,BED_TEMP:t.bedTemp,HOTEND_TEMP:t.hotendTemp,FIRST_LAYER_SPEED:t.firstLayerSpeed,PRINT_SPEED:t.printSpeed,TRAVEL_SPEED:t.travelSpeed,PRINT_ACCEL:t.printAccel,RETRACT_ACCEL:t.retractAccel,TRAVEL_ACCEL:t.travelAccel,FIRST_LAYER_PRINT_ACCEL:t.firstLayerPrintAccel,LAYER_HEIGHT:t.layerHeight,FIRST_LAYER_Z:t.firstLayerZ,TEXT_PRINT_SPEED:t.textSpeed,ROW_FONT_SIZE:t.rowFontSize,SPEED_FONT_SIZE:t.speedFontSize,EXTRUSION_WIDTH:t.extrusionWidth,FILAMENT_DIAMETER:1.75,ROW_GAP:t.rowGap,MARGIN:t.margin,DIST_LABEL_PAD:t.distLabelPad,PRESSURE_ADVANCE:t.pressureAdvance};e.FILAMENT_AREA=_e(e.FILAMENT_DIAMETER);const r=me(e.EXTRUSION_WIDTH,e.LAYER_HEIGHT,e.FILAMENT_AREA);e.E_PER_MM=r*e.FLOW_FACTOR,e.AVG_RETRACT_DIST=.5*(e.MIN_RETRACT_DIST+e.MAX_RETRACT_DIST),e.AVG_RETRACT_SPEED=.5*(e.MIN_RETRACT_SPEED+e.MAX_RETRACT_SPEED);const n=[];n.push("; Retraction DOE Test"),n.push("; Generated by retraction_doe_generator (Vite + modular)"),n.push(`; Retraction distance: ${e.MIN_RETRACT_DIST}..${e.MAX_RETRACT_DIST} mm`),n.push(`; Retraction speed:    ${e.MIN_RETRACT_SPEED}..${e.MAX_RETRACT_SPEED} mm/s`),n.push(`; Row repetitions (parallel lines per parameter): ${e.LINES_PER_PARAM}`),n.push(`; Flow factor: ${e.FLOW_FACTOR.toFixed(3)}`),n.push("; Always prints: grid frame + L-shaped label base + labels."),n.push("");const o=t.startGcode||te,s=t.endGcode||ne,i=K(o,e.BED_TEMP,e.HOTEND_TEMP).trim(),d=K(s,e.BED_TEMP,e.HOTEND_TEMP).trim();if(i){if(n.push(i),n.push(""),Number.isFinite(e.PRESSURE_ADVANCE)){const G=e.PRESSURE_ADVANCE;n.push(`pressure_advance = ${G}`),n.push(`M572 S${G}`),n.push("")}let x=e.FIRST_LAYER_PRINT_ACCEL!==null&&e.FIRST_LAYER_PRINT_ACCEL!==void 0?e.FIRST_LAYER_PRINT_ACCEL:e.PRINT_ACCEL;const M=Number.isFinite(e.RETRACT_ACCEL)?e.RETRACT_ACCEL:"",y=Number.isFinite(e.TRAVEL_ACCEL)?e.TRAVEL_ACCEL:"";(Number.isFinite(x)||M!==""||y!=="")&&(n.push(`M204 P${x} R${M} T${y}`),n.push(""))}const R=Q(e.ROWS,e.MIN_RETRACT_DIST,e.MAX_RETRACT_DIST),p=Q(e.COLS,e.MIN_RETRACT_SPEED,e.MAX_RETRACT_SPEED),c=e.COLS*(e.SEGMENT_LENGTH+e.TRAVEL_LENGTH)+e.SEGMENT_LENGTH,a=e.LINES_PER_PARAM*e.EXTRUSION_WIDTH+e.ROW_GAP,u=e.ROWS*a-e.ROW_GAP+e.EXTRUSION_WIDTH,L=1,A=1;let _=0;R.forEach(x=>{const M=(x.toFixed(2)+"mm").length*Y*e.ROW_FONT_SIZE;M>_&&(_=M)});const D=_+L+e.DIST_LABEL_PAD,f=Math.max(e.MARGIN,e.SPEED_FONT_SIZE+A),I=D+c+e.MARGIN,b=f+u;if(I>e.BED_SIZE_X+1e-6||b>e.BED_SIZE_Y+1e-6)throw new Error(`Pattern+labels too big for bed: needs ${I.toFixed(2)} x ${b.toFixed(2)} mm, bed is ${e.BED_SIZE_X.toFixed(2)} x ${e.BED_SIZE_Y.toFixed(2)} mm`);const l=(e.BED_SIZE_X-I)/2,E=(e.BED_SIZE_Y-b)/2,m=l+D,h=E+f;n.push(`; Centered on bed ${e.BED_SIZE_X}x${e.BED_SIZE_Y} mm`),n.push(`; Base bbox origin: X${l.toFixed(2)} Y${E.toFixed(2)}`),n.push(`; Pattern origin:   X${m.toFixed(2)} Y${h.toFixed(2)}`),n.push(`; Left label area:  ${D.toFixed(2)} mm, Bottom label margin: ${f.toFixed(2)} mm`),n.push("");const S=e.FIRST_LAYER_Z,F=S+e.LAYER_HEIGHT;if(n.push(T({z:S,f:e.TRAVEL_SPEED*60,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),Re(n,e,{baseX0:l,baseY0:E,originX:m,originY:h,leftLabelArea:D,bottomLabelMargin:f,patternWidth:c,patternHeight:u,z:S}),Le(n,e,{z:S,originX:m,originY:h,rows:e.ROWS,cols:e.COLS,rowBlockHeight:a,patternWidth:c}),n.push(""),n.push(`; === DOE Layer 1/${e.NUM_DOE_LAYERS} at Z=${S.toFixed(3)}, speed=${e.FIRST_LAYER_SPEED}mm/s ===`),H(n,e,{z:S,originX:m,originY:h,rows:e.ROWS,cols:e.COLS,distances:R,speeds:p,rowBlockHeight:a,patternWidth:c,printSpeed:e.FIRST_LAYER_SPEED}),e.NUM_DOE_LAYERS>=2){const x=Number.isFinite(e.PRINT_ACCEL)?e.PRINT_ACCEL:"",M=Number.isFinite(e.RETRACT_ACCEL)?e.RETRACT_ACCEL:"",y=Number.isFinite(e.TRAVEL_ACCEL)?e.TRAVEL_ACCEL:"";(x!==""||M!==""||y!=="")&&(n.push(""),n.push(`M204 P${x} R${M} T${y}`),n.push(""))}e.NUM_DOE_LAYERS>=2&&(n.push(""),n.push("; --- Printing labels for distances and speeds on second layer ---"),be(n,e,{originX:m,originY:h,baseX0:l,baseY0:E,rowBlockHeight:a,distLevels:R,speedLevels:p,rowFontSize:e.ROW_FONT_SIZE,speedFontSize:e.SPEED_FONT_SIZE,labelGapX:L,bottomLabelMargin:f,zLabel:F}),n.push(""),n.push(`; === DOE Layer 2/${e.NUM_DOE_LAYERS} at Z=${F.toFixed(3)}, speed=${e.PRINT_SPEED}mm/s ===`),H(n,e,{z:F,originX:m,originY:h,rows:e.ROWS,cols:e.COLS,distances:R,speeds:p,rowBlockHeight:a,patternWidth:c,printSpeed:e.PRINT_SPEED}));for(let x=2;x<e.NUM_DOE_LAYERS;x++){const M=S+x*e.LAYER_HEIGHT;n.push(""),n.push(`; === DOE Layer ${x+1}/${e.NUM_DOE_LAYERS} at Z=${M.toFixed(3)}, speed=${e.PRINT_SPEED}mm/s ===`),H(n,e,{z:M,originX:m,originY:h,rows:e.ROWS,cols:e.COLS,distances:R,speeds:p,rowBlockHeight:a,patternWidth:c,printSpeed:e.PRINT_SPEED})}const C=V(e.AVG_RETRACT_DIST,e.AVG_RETRACT_SPEED);return n.push(""),n.push("; Final retraction"),n.push(C.retract),d&&(n.push(""),n.push(d)),n.join(`
`)+`
`}function ee(t,e,r,n,o,s,i,d){const R=i.TEXT_PRINT_SPEED*60,p=i.TRAVEL_SPEED*60,c=i.E_PER_MM;let a=r;for(const u of e){if(u===" "){a+=Y*o;continue}const L=pe[u];if(!L){a+=Y*o;continue}for(const A of L){const[[_,D],[f,I]]=A,b=a+_*o,l=n+D*o,E=a+f*o,m=n+I*o;t.push("; Label retract before travel"),t.push(d.retract),t.push(T({x:b,y:l,z:s,f:p,bedX:i.BED_SIZE_X,bedY:i.BED_SIZE_Y})),t.push("; Label deretract before stroke"),t.push(d.deretract);const S=Math.hypot(E-b,m-l)*c;t.push(T({x:E,y:m,e:S,f:R,bedX:i.BED_SIZE_X,bedY:i.BED_SIZE_Y}))}a+=Y*o}}function Re(t,e,r){const{baseX0:n,baseY0:o,originX:s,originY:i,leftLabelArea:d,bottomLabelMargin:R,patternWidth:p,patternHeight:c,z:a}=r;t.push(`; --- L-shaped label base at Z=${a.toFixed(3)} ---`);const u=e.FIRST_LAYER_SPEED*60,L=e.TRAVEL_SPEED*60,A=e.EXTRUSION_WIDTH,_=e.E_PER_MM,D=d,f=n,I=p,b=s,l=o,E=d,m=n,h=o,S=e.EXTRUSION_WIDTH,F=n,C=o,x=s+p,M=i+c,y=s-S,G=i-S;t.push(`; L-shape perimeter for adhesion (offset by ${S.toFixed(3)}mm from grid)`),t.push(T({x:F,y:C,z:a,f:L,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}));let P,N;P=x-F,N=P*_,t.push(T({x,y:C,e:N,f:u,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),P=G-C,N=P*_,t.push(T({x,y:G,e:N,f:u,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),P=x-y,N=P*_,t.push(T({x:y,y:G,e:N,f:u,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),P=M-G,N=P*_,t.push(T({x:y,y:M,e:N,f:u,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),P=y-F,N=P*_,t.push(T({x:F,y:M,e:N,f:u,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),P=M-C,N=P*_,t.push(T({x:F,y:C,e:N,f:u,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}));function v(B,Z,$,O,ue){if($<=0||O<=0)return;t.push(`; ${ue}: X${B.toFixed(3)} Y${Z.toFixed(3)} W${$.toFixed(3)} H${O.toFixed(3)}`),t.push(T({x:B,y:Z,z:a,f:L,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}));const Ee=Math.round(O/A);for(let w=0;w<Ee;w++){const j=Z+w*A,J=w%2===0?B:B+$,q=w%2===0?B+$:B;t.push(T({x:J,y:j,f:L,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}));const ce=Math.abs(q-J)*_;t.push(T({x:q,y:j,e:ce,f:u,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}))}}const X=Math.floor((R-2*S)/A)*A,le=X,k=h+S+X,de=i+c-k,ae=Math.ceil(de/A)*A;v(m+S,h+S,E-2*S,X,"L-corner fill"),v(f+S,k,D-2*S,ae,"L-left fill"),v(b,l+S,I-S,le,"L-bottom fill")}function Le(t,e,r){const{z:n,originX:o,originY:s,rows:i,cols:d,rowBlockHeight:R,patternWidth:p}=r;t.push(`; --- Grid frame layer at Z=${n.toFixed(3)} ---`);const c=e.FIRST_LAYER_SPEED*60,a=e.TRAVEL_SPEED*60,u=e.E_PER_MM,L=i*R-e.ROW_GAP+e.EXTRUSION_WIDTH,A=e.SEGMENT_LENGTH+e.TRAVEL_LENGTH,_=o,D=o+p,f=s,I=s+L,b=V(e.AVG_RETRACT_DIST,e.AVG_RETRACT_SPEED);t.push("; Grid frame: outer rectangle"),t.push("; Grid retract before travel to outer start"),t.push(b.retract),t.push(T({x:_,y:f,z:n,f:a,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),t.push("; Grid deretract before outer rectangle"),t.push(b.deretract);let l,E;l=D-_,E=l*u,t.push(T({x:D,y:f,e:E,f:c,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),l=I-f,E=l*u,t.push(T({x:D,y:I,e:E,f:c,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),l=D-_,E=l*u,t.push(T({x:_,y:I,e:E,f:c,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),l=I-f,E=l*u,t.push(T({x:_,y:f,e:E,f:c,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),t.push("; Grid frame: vertical lines between columns");for(let m=1;m<d;m++){const h=o+m*A;t.push("; Grid retract before vertical travel"),t.push(b.retract),t.push(T({x:h,y:f,z:n,f:a,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),t.push("; Grid deretract before vertical line"),t.push(b.deretract),l=I-f,E=l*u,t.push(T({x:h,y:I,e:E,f:c,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}))}t.push("; Grid frame: horizontal lines between rows");for(let m=1;m<i;m++){const h=s+m*R;t.push("; Grid retract before horizontal travel"),t.push(b.retract),t.push(T({x:_,y:h,z:n,f:a,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),t.push("; Grid deretract before horizontal line"),t.push(b.deretract),l=D-_,E=l*u,t.push(T({x:D,y:h,e:E,f:c,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y}))}}function H(t,e,r){const{z:n,originX:o,originY:s,rows:i,cols:d,distances:R,speeds:p,rowBlockHeight:c,patternWidth:a,printSpeed:u}=r;t.push(`; --- DOE layer at Z=${n.toFixed(3)} ---`);const L=u*60,A=e.TRAVEL_SPEED*60,_=e.E_PER_MM,D=e.EXTRUSION_WIDTH;for(let f=0;f<i;f++){const I=R[f],b=s+f*c+D;t.push(`; ===== Distance row ${f+1}/${i}, dist=${I.toFixed(3)}mm =====`);let l=o;for(let E=0;E<e.LINES_PER_PARAM;E++){const m=E%2===0?1:-1,h=b+E*e.EXTRUSION_WIDTH;E===0&&(l=o),t.push(T({x:l,y:h,z:n,f:A,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),t.push(`; Row ${f+1}/${i}, repetition ${E+1}/${e.LINES_PER_PARAM}, dist=${I.toFixed(3)}mm, dir=${m>0?"L->R":"R->L"}`);const S=m>0?[...Array(d).keys()]:[...Array(d).keys()].reverse();for(const M of S){const y=p[M],G=fe(I,y);t.push(`;   Col ${M+1}/${d}, speed=${y.toFixed(1)}mm/s`);let P=l+m*e.SEGMENT_LENGTH,v=Math.abs(P-l)*_;t.push(T({x:P,y:h,e:v,f:L,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),l=P,t.push(G.retract);let X=l+m*e.TRAVEL_LENGTH;t.push(T({x:X,y:h,f:A,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),l=X,t.push(G.deretract)}t.push(";   Final normal print section at end of repetition line");const F=l+m*e.SEGMENT_LENGTH,x=Math.abs(F-l)*_;t.push(T({x:F,y:h,e:x,f:L,bedX:e.BED_SIZE_X,bedY:e.BED_SIZE_Y})),l=F}}}function be(t,e,r){const{originX:n,originY:o,baseX0:s,baseY0:i,rowBlockHeight:d,distLevels:R,speedLevels:p,rowFontSize:c,speedFontSize:a,labelGapX:u,bottomLabelMargin:L,zLabel:A}=r,_=V(e.AVG_RETRACT_DIST,e.AVG_RETRACT_SPEED);R.forEach((I,b)=>{const l=I.toFixed(2)+"mm",E=l.length*Y*c,h=o+b*d+d/2-c/2,S=n-u-E,F=s+e.DIST_LABEL_PAD,C=Math.max(S,F);t.push(`; Text label for distance row ${b+1}: ${l}`),ee(t,l,C,h,c,A,e,_)});const D=e.SEGMENT_LENGTH+e.TRAVEL_LENGTH,f=i+(L-a)/2;p.forEach((I,b)=>{const l=I.toFixed(0)+"mm/s",E=l.length*Y*a,S=n+b*D+e.SEGMENT_LENGTH+e.TRAVEL_LENGTH/2-E/2;t.push(`; Text label for speed col ${b+1}: ${l}`),ee(t,l,S,f,a,A,e,_)})}const U={},re={};let g=!1;async function Ie(){if(!g)try{const t=await fetch("./presets/manifest.json");if(!t.ok)throw new Error(`Failed to load manifest: ${t.status}`);const e=await t.json();for(const r of e)try{const n=await fetch(`./presets/${r.file}`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const o=await n.json();U[r.id]=o,re[r.id]=r}catch(n){console.error(`Failed to load preset ${r.id}:`,n)}g=!0}catch(t){console.error("Failed to load manifest:",t)}}async function Ae(){g||await Ie()}function oe(t){return U[t]||null}function De(){return Object.keys(U)}function se(t){var e;return((e=re[t])==null?void 0:e.name)||t}function ie(){const t=p=>document.getElementById(p),e=(p,c,a)=>{const u=t(p)||c&&t(c);if(!u)return a;const L=u.value;return L===""||L===void 0?a:Number(L)},r=(p,c,a)=>{const u=e(p,c,a);return Number.isNaN(u)?a:Math.trunc(u)},n=e("retractDist",null,null),o=e("minDist",null,n),s=e("maxDist",null,n),i=e("retractSpeed",null,null),d=e("minSpeed",null,i),R=e("maxSpeed",null,i);return{bedX:e("bedX",null,220),bedY:e("bedY",null,220),bedTemp:e("bedTemp",null,60),minDist:o,maxDist:s,hotendTemp:e("hotendTemp",null,210),minSpeed:d,maxSpeed:R,flowFactor:e("flowFactor",null,1),firstLayerSpeed:e("firstLayerSpeed",null,30),printSpeed:e("printSpeed",null,50),travelSpeed:e("travelSpeed",null,150),printAccel:e("printAccel",null,1500),retractAccel:e("retractAccel",null,2500),travelAccel:e("travelAccel",null,5e3),layerHeight:e("layerHeight",null,.2),pressureAdvance:function(){const p=t("pressureAdvance");return p?p.value===""?null:Number(p.value):null}(),firstLayerZ:e("firstLayerZ",null,.2),textSpeed:e("textSpeed",null,20),rowFontSize:e("rowFontSize",null,3),speedFontSize:e("speedFontSize",null,3),extrusionWidth:e("extrusionWidth",null,.44),rowGap:e("rowGap",null,1),margin:e("margin",null,5),distLabelPad:e("distLabelPad",null,1),linesPerParam:r("linesPerParam","doeLines",12),rows:r("rows","doeRows",5),cols:r("cols","doeColumns",5),segLen:e("segLen","doeSegments",15),travelLen:e("travelLen",null,15),numLayers:r("numLayers",null,5),firstLayerPrintAccel:function(){const p=e("firstLayerPrintAccel",null,null);return p===null?null:p}(),startGcode:(document.getElementById("startGcode")||{value:""}).value,endGcode:(document.getElementById("endGcode")||{value:""}).value,presetName:(t("presetName")||{value:""}).value,presetDescription:(t("presetDescription")||{value:""}).value}}function z(t){const e=(r,n,o)=>{const s=document.getElementById(r)||n&&document.getElementById(n);s&&(s.value=o==null?"":String(o))};t.bedX!==void 0&&e("bedX",null,t.bedX),t.bedY!==void 0&&e("bedY",null,t.bedY),t.bedTemp!==void 0&&e("bedTemp",null,t.bedTemp),t.minDist!==void 0&&e("minDist","retractDist",t.minDist),t.maxDist!==void 0&&e("maxDist",null,t.maxDist),t.hotendTemp!==void 0&&e("hotendTemp",null,t.hotendTemp),t.minSpeed!==void 0&&e("minSpeed","retractSpeed",t.minSpeed),t.maxSpeed!==void 0&&e("maxSpeed",null,t.maxSpeed),t.flowFactor!==void 0&&e("flowFactor",null,t.flowFactor),t.firstLayerSpeed!==void 0&&e("firstLayerSpeed",null,t.firstLayerSpeed),t.printSpeed!==void 0&&e("printSpeed",null,t.printSpeed),t.travelSpeed!==void 0&&e("travelSpeed",null,t.travelSpeed),t.printAccel!==void 0&&e("printAccel",null,t.printAccel),t.retractAccel!==void 0&&e("retractAccel",null,t.retractAccel),t.travelAccel!==void 0&&e("travelAccel",null,t.travelAccel),t.layerHeight!==void 0&&e("layerHeight",null,t.layerHeight),t.pressureAdvance!==void 0&&e("pressureAdvance",null,t.pressureAdvance),t.firstLayerZ!==void 0&&e("firstLayerZ",null,t.firstLayerZ),t.textSpeed!==void 0&&e("textSpeed",null,t.textSpeed),t.rowFontSize!==void 0&&e("rowFontSize",null,t.rowFontSize),t.speedFontSize!==void 0&&e("speedFontSize",null,t.speedFontSize),t.extrusionWidth!==void 0&&e("extrusionWidth",null,t.extrusionWidth),t.rowGap!==void 0&&e("rowGap",null,t.rowGap),t.margin!==void 0&&e("margin",null,t.margin),t.distLabelPad!==void 0&&e("distLabelPad",null,t.distLabelPad),t.linesPerParam!==void 0&&e("linesPerParam","doeLines",t.linesPerParam),t.rows!==void 0&&e("rows","doeRows",t.rows),t.cols!==void 0&&e("cols","doeColumns",t.cols),t.segLen!==void 0&&e("segLen","doeSegments",t.segLen),t.travelLen!==void 0&&e("travelLen",null,t.travelLen),t.numLayers!==void 0&&e("numLayers",null,t.numLayers),t.firstLayerPrintAccel!==void 0&&e("firstLayerPrintAccel",null,t.firstLayerPrintAccel),t.startGcode!==void 0&&e("startGcode",null,t.startGcode),t.endGcode!==void 0&&e("endGcode",null,t.endGcode),t.presetName!==void 0&&e("presetName",null,t.presetName),t.presetDescription!==void 0&&e("presetDescription",null,t.presetDescription)}function xe(){const t=document.getElementById("preset-select");t.innerHTML='<option value="">-- Select a printer --</option>',De().forEach(e=>{const r=se(e),n=document.createElement("option");n.value=e,n.textContent=r,t.appendChild(n)})}function Me(){const t=document.getElementById("preset-select"),e=document.getElementById("preset-status"),r=t.value;if(!r){e.textContent="";return}const n=oe(r);if(!n){e.textContent="Preset not found",e.style.color="#ef4444";return}z(n);const o=n.name||n.presetName,s=n.description||n.presetDescription;o&&(document.getElementById("presetName").value=o),s&&(document.getElementById("presetDescription").value=s),e.textContent=`Loaded: ${o||"Preset"}`,e.style.color="#059669"}function Pe(t){const e=document.getElementById("preset-status"),r=t.target.files[0];if(!r)return;const n=new FileReader;n.onload=function(o){try{const s=JSON.parse(o.target.result);z(s);const i=s.name||s.presetName,d=s.description||s.presetDescription;i&&(document.getElementById("presetName").value=i),d&&(document.getElementById("presetDescription").value=d),e.textContent=`Loaded: ${i||"Custom settings"}`,e.style.color="#059669"}catch(s){e.textContent="Error parsing JSON: "+s.message,e.style.color="#ef4444",console.error(s)}},n.onerror=function(){e.textContent="Error reading file",e.style.color="#ef4444"},n.readAsText(r),t.target.value=""}function W(){var c,a,u,L,A,_;const t=parseFloat(((c=document.getElementById("minDist"))==null?void 0:c.value)||.2),e=parseFloat(((a=document.getElementById("maxDist"))==null?void 0:a.value)||1.2),r=parseFloat(((u=document.getElementById("minSpeed"))==null?void 0:u.value)||10),n=parseFloat(((L=document.getElementById("maxSpeed"))==null?void 0:L.value)||100),o=parseInt(((A=document.getElementById("doeRows"))==null?void 0:A.value)||5),s=parseInt(((_=document.getElementById("doeColumns"))==null?void 0:_.value)||5),i=o>1?((e-t)/(o-1)).toFixed(2):0,d=s>1?((n-r)/(s-1)).toFixed(1):0,R=document.getElementById("distIncrement"),p=document.getElementById("speedIncrement");R&&(R.textContent=i),p&&(p.textContent=d)}function Fe(){const t=document.getElementById("output"),e=document.getElementById("status");try{e.textContent="Generatingâ€¦",e.classList.remove("error");const r=ie(),n=he(r);t.value=n,e.textContent="G-code generated. You can download it now.",document.getElementById("download-btn").disabled=!1}catch(r){e.textContent="Error: "+r.message,e.classList.add("error"),document.getElementById("download-btn").disabled=!0,console.error(r)}}function ye(){const t=document.getElementById("output").value;if(!t.trim())return;const e=new Blob([t],{type:"text/plain"}),r=URL.createObjectURL(e),n=document.createElement("a");n.href=r,n.download=Te(),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}function Ne(){const t=ie(),e=t.presetName||"untitled",r=new Date,n=`${r.getFullYear()}${String(r.getMonth()+1).padStart(2,"0")}${String(r.getDate()).padStart(2,"0")}-${String(r.getHours()).padStart(2,"0")}${String(r.getMinutes()).padStart(2,"0")}`,o=JSON.stringify(t,null,2),s=new Blob([o],{type:"application/json"}),i=URL.createObjectURL(s),d=document.createElement("a");d.href=i;const R=e.replace(/\s+/g,"_").toLowerCase();d.download=`${R}_${n}.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(i)}async function Ce(){await Ae();const t=oe("default");if(t){z(t);const o=document.getElementById("preset-select");o&&(o.value="default");const s=document.getElementById("preset-status");s&&(s.textContent=`Loaded: ${se("default")}`)}const e=document.getElementById("startGcode"),r=document.getElementById("endGcode");e&&!e.value&&(e.value=te),r&&!r.value&&(r.value=ne),xe(),document.getElementById("load-preset-btn").addEventListener("click",Me),document.getElementById("generate-btn").addEventListener("click",Fe),document.getElementById("download-btn").addEventListener("click",ye),document.getElementById("download-json-btn").addEventListener("click",Ne),document.getElementById("upload-json-input").addEventListener("change",Pe),["minDist","maxDist","minSpeed","maxSpeed","doeRows","doeColumns"].forEach(o=>{const s=document.getElementById(o);s&&(s.addEventListener("input",W),s.addEventListener("change",W))}),W()}window.addEventListener("DOMContentLoaded",Ce);
